package combat;

import org.bukkit.entity.LivingEntity;
import org.bukkit.entity.Player;
import org.bukkit.event.entity.EntityDamageByEntityEvent;
import org.bukkit.event.entity.EntityDamageEvent;
import org.bukkit.potion.PotionEffect;
import org.bukkit.potion.PotionEffectType;

import actives.Active;
import actives.Active.ActiveState;
import actives.Active.ActiveType;
import skills.Skill;
import skills.SkillHandler;
import skills.SkillType;

public class Toughness extends Skill {

	public Toughness(Player player, int level, int exp) {
		super(player, level, exp);
	}
	
	@Override
	public void info() {
		super.info();
		message(0, "Active: Your punch disorents the next target for a shot time."); //implemented?
	    message(0, "Passive: Increase fist damage done by " + level/5 + "%");
		message(250, "Level 250 Passive: Halves damage taken form enviormental effects");
		message(750, "Level 750 Passive: Damage taken increases resistance for a short time");
	}
	
	public static void combat(EntityDamageByEntityEvent event) {
		Player damager = (Player) event.getDamager();
		Skill toughness = SkillHandler.getSkill(damager, SkillType.TOUGHNESS);
		if (Active.getState(damager, ActiveType.TOUGHNESS).equals(ActiveState.PRIMED)) {
			Active.activate(damager, ActiveType.TOUGHNESS, 0, 300);
			int level = toughness.level();
			LivingEntity target = (LivingEntity) event.getEntity();
			if (level < 250) {
				target.setVelocity(damager.getLocation().getDirection());
			}
			else if (level < 500) {
				target.setVelocity(damager.getLocation().getDirection().multiply(2));
			}
			else if (level < 750) {
				target.addPotionEffect(new PotionEffect(PotionEffectType.CONFUSION, 240, 2));
			}
			else {
				target.addPotionEffect(new PotionEffect(PotionEffectType.CONFUSION, 240, 3));
			}
		}
		double damage = event.getDamage();
		damage = damage * (1 + toughness.level() / 500.0);
		event.setDamage(damage);
		toughness.addExp((int) event.getDamage());
	}

	public static void toughness(EntityDamageEvent event) {
		Player player = (Player) event.getEntity();
		Skill toughness = SkillHandler.getSkill(player, SkillType.TOUGHNESS);
		switch (event.getCause()) {
		case DROWNING:
		case STARVATION:
		case SUFFOCATION:
			if (toughness.level() >= 250) {
				event.setDamage(event.getDamage() / 2);
			}
			break;
		default:
			break;
		}
	}
}
