package qplayer;

import industry.IndustryBuff;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.lang.ref.WeakReference;
import java.util.HashMap;

import main.QCraft;

import org.bukkit.block.Block;
import org.bukkit.entity.Player;
import org.bukkit.permissions.PermissionAttachment;

import custom.Tool;
import skills.Skill;
import skills.SkillType;
import economy.Money;
import factions.Power;

/*
 * Our class to store all the information QCraft will need (Money, Faction, Active, and Skill data)
 */

public class QPlayer implements ActionListener {
	private WeakReference<Player> player;
	private Money money;
	private String faction = null;
	private Power power;
	private HashMap<SkillType, Skill> skills = new HashMap<SkillType, Skill>();
	private IndustryBuff industryBuff;
	private PermissionAttachment permissions;

	public QPlayer(Player player) {
		this.player = new WeakReference<Player>(player);
		power = new Power(player, 0);
		permissions = player.addAttachment(QCraft.get());
		for (SkillType skill : SkillType.values()) {
			skills.put(skill, SkillType.newSkill(skill, player, 0, 0));
		}
		industryBuff = new IndustryBuff(player);
	}
	
	public void relinkPlayer(Player player) {
		this.player = new WeakReference<Player>(player);
	}
	
	public void setMoney(int amount) {
		money = new Money(player.get(), amount);
	}
	
	public Money getMoney() {
		return money;
	}
	
	public void setFaction(String faction) {
		this.faction = faction;
	}
	
	public String getFaction() {
		return faction;
	}
	
	public void setPower(int power) {
		this.power = new Power(player.get(), power);
	}
	
	public int getPower() {
		return power.getPower();
	}
	
	public void setSkill(SkillType skill, int level, int exp) {
		skills.put(skill, SkillType.newSkill(skill, player.get(), level, exp));
	}
	
	public void setSkills(HashMap<SkillType, Skill> skills) {
		this.skills = skills;
	}
	
	public Skill getSkill(SkillType skill) {
		return skills.get(skill);
	}
	
	public void applyIndustryBuff(Block block, Tool tool) {
		industryBuff.buff(block, tool);
	}
	
	public void removeIndustryBuff() {
		industryBuff.removeBuff();
	}
	
	public void setPermission(String name, boolean value) {
		permissions.setPermission(name, value);
	}
	
	public void removePermission(String name) {
		permissions.unsetPermission(name);
	}

	@Override
	public void actionPerformed(ActionEvent arg0) {
		// TODO Auto-generated method stub
		
	}
}
